FROM centos:7.9
MAINTAINER wanglijie

RUN yum install -y gcc gcc-c++
RUN yum install -y pcre pcre-devel
RUN yum install -y zlib zlib-devel
RUN yum install -y openssl openssl-devel
RUN yum install -y tcl

RUN mkdir -p /usr/local/redis
RUN mkdir -p /usr/local/redis/sbin
RUN mkdir -p /usr/local/redis/etc
RUN mkdir -p /var/redis/log
RUN cd /usr/local/redis
RUN wget https://download.redis.io/releases/redis-5.0.14.tar.gz
RUN tar -xzvf redis-5.0.14.tar.gz
RUN tar -xzvf redis-5.0.14.tar.gz
RUN make && make install

RUN cp /usr/local/redis/redis-5.0.14/src/redis-server /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-cli /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-sentinel /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-trib.rb /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-check-rdb /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-check-aof /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/src/redis-benchmark /usr/local/redis/sbin
RUN cp /usr/local/redis/redis-5.0.14/redis.conf /usr/local/redis/etc

RUN mkdir -p /usr/local/nginx
RUN mkdir -p /usr/local/nginx/tmp/client
RUN groupadd nginx
RUN useradd nginx -g nginx
RUN cd /usr/local/nginx
RUN wget https://nginx.org/download/nginx-1.22.0.tar.gz
RUN tar -xzvf nginx-1.22.0.tar.gz
RUN cd nginx-1.22.0
RUN ./configure --prefix=/usr/local/nginx  --conf-path=/usr/local/nginx/conf/nginx.conf --user=nginx --group=nginx  --error-log-path=/usr/local/nginx/logs/error.log  --http-log-path=/usr/local/nginx/logs/access.log  --pid-path=/usr/local/nginx/pids/nginx.pid  --lock-path=/usr/local/nginx/locks/nginx.lock  --with-http_ssl_module  --with-http_stub_status_module  --with-http_gzip_static_module  --with-http_sub_module --http-client-body-temp-path=/usr/local/nginx/tmp/client  --http-proxy-temp-path=/usr/local/nginx/tmp/proxy  --http-fastcgi-temp-path=/usr/local/nginx/tmp/fastcgi  --http-uwsgi-temp-path=/usr/local/nginx/tmp/uwsgi  --http-scgi-temp-path=/usr/local/nginx/tmp/scgi
run make && make install
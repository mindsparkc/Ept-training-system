<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinosoft.system.mapper.SysTenantMapper">
    <resultMap type="SysTenant" id="SysTenantResult">
        <result property="id"                   column="id"       />
        <result property="tenantName"           column="tenant_name"    />
        <result property="phonenumber"          column="phonenumber"     />
        <result property="email"                column="email"  />
        <result property="linkman"              column="linkman"  />
        <result property="userName"             column="user_name"  />
        <result property="nickName"             column="nick_name"  />
        <result property="password"             column="password"  />
        <result property="registerTime"         column="register_time"  />
        <result property="remark"               column="remark"  />
        <result property="vipGrade"             column="vip_grade"  />
        <result property="vipStartTime"         column="vip_start_time"  />
        <result property="vipEndTime"           column="vip_end_time"  />
        <result property="status"               column="status"          />
        <result property="deptCreateFlag"       column="dept_create_flag"       />
        <result property="deptCreateTime"       column="dept_create_time"       />
        <result property="deptId"               column="dept_id"       />
        <result property="userCreateFlag"       column="user_create_flag"       />
        <result property="userCreateTime"       column="user_create_time"       />
        <result property="userId"               column="user_id"       />
        <result property="delFlag"              column="del_flag"       />
        <result property="createBy"             column="create_by"       />
        <result property="createTime"           column="create_time"     />
        <result property="updateBy"             column="update_by"       />
        <result property="updateTime"           column="update_time"     />
    </resultMap>

    <sql id="selectTenantVo">
        select  t.id,t.tenant_name,t.phonenumber,t.email,t.linkman,
                t.user_name,t.nick_name,t.password,t.register_time,t.remark,
                t.vip_grade,t.vip_start_time,t.vip_end_time,
                t.dept_create_flag,t.dept_create_time,t.dept_id,
                t.user_create_flag,t.user_create_time,t.user_id,
                t.status, t.create_by, t.create_time, t.update_by, t.update_time,t.del_flag
		from sys_tenant t
    </sql>

    <select id="selectTenantById" parameterType="Long" resultMap="SysTenantResult">
        <include refid="selectTenantVo"/>  where t.id = #{id}
    </select>

    <select id="selectTenantList" parameterType="SysTenant" resultMap="SysTenantResult">
        <include refid="selectTenantVo"/>
        <where>
			<if test="tenantName != null and tenantName != ''">
				AND t.tenant_name like concat('%', #{tenantName}, '%')
			</if>
            <if test="deptId != null and deptId != ''">
                AND t.dept_id = #{deptId}
            </if>
            <if test="userId != null and userId != ''">
                AND t.userId = #{userId}
            </if>
            <if test="status != null and status != ''">
                AND t.status = #{status}
            </if>
            <if test="phonenumber != null and phonenumber != ''">
                AND t.phonenumber = #{phonenumber}
            </if>
            <if test="userName != null and userName != ''">
                AND t.user_name = #{userName}
            </if>
            <if test="nickName != null and nickName != ''">
                AND t.nick_name like concat('%', #{nickName}, '%')
            </if>
            <if test="vipGrade != null and vipGrade != ''">
                AND t.vip_grade = #{vipGrade}
            </if>
            <if test="linkman != null and linkman != ''">
                AND t.linkman like concat('%', #{linkman}, '%')
            </if>
			<if test="createBy != null and createBy != ''">
				AND sn.create_by like concat('%', #{createBy}, '%')
			</if>
			AND t.del_flag = '0'
			order by t.update_time DESC
		</where>

    </select>

    <insert id="insertTenant" parameterType="SysTenant" useGeneratedKeys="true" keyProperty="id">
        insert into sys_tenant (
            <if test="tenantName != null and tenantName != '' ">tenant_name, </if>
            <if test="phonenumber != null and phonenumber != '' ">phonenumber, </if>
            <if test="email != null and email != '' ">email, </if>
            <if test="linkman != null and linkman != '' ">linkman, </if>
            <if test="userName != null and userName != '' ">user_name, </if>
            <if test="nickName != null and nickName != '' ">nick_name, </if>
            <if test="password != null and password != '' ">password, </if>
            <if test="registerTime != null">register_time, </if>
            <if test="vipGrade != null and vipGrade != '' ">vip_grade, </if>
            <if test="vipStartTime != null">vip_start_time, </if>
            <if test="vipEndTime != null">vip_end_time, </if>
            <if test="deptCreateFlag != null and deptCreateFlag != '' ">dept_create_flag, </if>
            <if test="deptCreateTime != null">dept_create_time, </if>
            <if test="deptId != null">dept_id, </if>
            <if test="userCreateFlag != null and userCreateFlag != '' ">user_create_flag, </if>
            <if test="userCreateTime != null">user_create_time, </if>
            <if test="userId != null">user_id, </if>
            <if test="status != null and status != '' ">status, </if>
            <if test="remark != null and remark != ''">remark,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            create_time
 		)values(
            <if test="tenantName != null and tenantName != '' ">#{tenantName},</if>
            <if test="phonenumber != null and phonenumber != '' ">#{phonenumber}, </if>
            <if test="email != null and email != '' ">#{email}, </if>
            <if test="linkman != null and linkman != '' ">#{linkman}, </if>
            <if test="userName != null and userName != '' ">#{userName}, </if>
            <if test="nickName != null and nickName != '' ">#{nickName}, </if>
            <if test="password != null and password != '' ">#{password}, </if>
            <if test="registerTime != null">#{registerTime}, </if>
            <if test="vipGrade != null and vipGrade != '' ">#{vipGrade}, </if>
            <if test="vipStartTime != null">#{vipStartTime}, </if>
            <if test="vipEndTime != null">#{vipEndTime}, </if>
            <if test="deptCreateFlag != null and deptCreateFlag != '' ">#{deptCreateFlag}, </if>
            <if test="deptCreateTime != null">#{deptCreateTime}, </if>
            <if test="deptId != null">#{deptId}, </if>
            <if test="userCreateFlag != null and userCreateFlag != '' ">#{userCreateFlag}, </if>
            <if test="userCreateTime != null">#{userCreateTime}, </if>
            <if test="userId != null">#{userId}, </if>
            <if test="status != null and status != '' ">#{status}, </if>
            <if test="remark != null and remark != ''">#{remark},</if>
            <if test="createBy != null and createBy != ''">#{createBy},</if>
 			sysdate()
		)
    </insert>

    <update id="updateTenant" parameterType="SysTenant">
        update sys_tenant
        <set>
            <if test="tenantName != null and tenantName != '' ">tenant_name = #{tenantName},</if>
            <if test="phonenumber != null and phonenumber != '' ">phonenumber = #{phonenumber}, </if>
            <if test="email != null and email != '' ">email= #{email}, </if>
            <if test="linkman != null and linkman != '' ">linkman = #{linkman}, </if>
            <if test="userName != null and userName != '' ">user_name = #{userName}, </if>
            <if test="nickName != null and nickName != '' ">nick_name = #{nickName}, </if>
            <if test="password != null and password != '' ">password = #{password}, </if>
            <if test="registerTime != null">register_time = #{registerTime}, </if>
            <if test="vipGrade != null and vipGrade != '' ">vip_grade = #{vipGrade}, </if>
            <if test="vipStartTime != null">vip_start_time = #{vipStartTime}, </if>
            <if test="vipEndTime != null">vip_end_time = #{vipEndTime}, </if>
            <if test="deptCreateFlag != null and deptCreateFlag != '' ">dept_create_flag = #{deptCreateFlag}, </if>
            <if test="deptCreateTime != null">dept_create_time = #{deptCreateTime}, </if>
            <if test="deptId != null">dept_id = #{deptId}, </if>
            <if test="userCreateFlag != null and userCreateFlag != '' ">user_create_flag = #{userCreateFlag}, </if>
            <if test="userCreateTime != null">user_create_time = #{userCreateTime}, </if>
            <if test="userId != null">user_id = #{userId}, </if>
            <if test="status != null and status != '' ">status = #{status}, </if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
 			update_time = sysdate()
        </set>
        where id = #{id}
    </update>

    <delete id="deleteTenantById" parameterType="Long">
        update sys_tenant set del_flag = '1' where id = #{id}
    </delete>

    <!--array的来由：MyBatis 自动将数组参数包装为 Map，键名默认为 array-->
    <!--当 Mapper 方法的参数为 List 时，MyBatis 会将其包装为 Map，默认键名为 list。就不能用array-->
    <!--在 MyBatis 中，当你将一个数组作为参数传递给 Mapper 方法时，MyBatis 会将这个数组参数包装在一个 Map 中，其中数组的默认键名就是 array。这就是为什么在你的 XML 映射文件中可以使用 collection="array" 的原因。-->
    <delete id="deleteTenantByIds" parameterType="Long">
        update sys_tenant set del_flag = '1'  where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <select id="checkTenantNameUnique" parameterType="String" resultType="int">
        select count(1) from sys_tenant where user_name = #{tenantName} limit 1
    </select>
</mapper>
